<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keys" content="">
    <meta name="author" content="">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/login.css">

    <title>注册</title>
    <script src="/lib/jquery.js"></script>
    <script src="/dist/jquery.validate.min.js"></script>
    <script src="/dist/localization/messages_zh.js"></script>
    <script>
        $.validator.addMethod("phonenumber",function (value,element) {
           var length=value.length;
           var phonenumber = /^(((13[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
            return this.optional(element) || (length == 11 && phonenumber.test(value));
        });
        $.validator.setDefaults({
            submitHandler: function() {
                $.ajax({
                    type:"POST",
                    url:"/insertUserInfo",
                    contentType:"application/json",
                    data: JSON.stringify({
                        "username":$("#username").val(),
                        "password":$("#password").val(),
                        "phonenumber":$("#phonenumber").val(),
                        "email":$("#email").val()
                    }),
                    success : function (data) {
                        window.location.href="login.html";
                    },
                    error : function (data) {
                        window.location.href="Test.html";
                    },
                    dataType: "json"
                });
            }
        });
        $().ready(function() {
            $("#commentForm").validate({
                rules: {
                    firstname: "required",
                    lastname: "required",
                    username: {
                        required: true,
                        minlength: 2,
                        remote:{
                            url:"/checkUserName",
                            type:"post",
                            data:{
                                username:function () {
                                    return $("#username").val();
                                }
                            }
                        }
                    },
                    password: {
                        required: true,
                        minlength: 2
                    },
                    confirm_password: {
                        required: true,
                        minlength: 2,
                        equalTo: "#password"
                    },
                    email: {
                        required: true,
                        email: true
                    },
                    phonenumber: {
                        required: true,
                        phonenumber: true
                    },
                    topic: {
                        required: "#newsletter:checked",
                        minlength: 2
                    },
                    agree: "required"
                },
                messages: {
                    firstname: "请输入您的名字",
                    lastname: "请输入您的姓氏",
                    username: {
                        required: "请输入用户名",
                        minlength: "用户名必需由两个字母组成",
                        remote:"用户名已存在"
                    },
                    password: {
                        required: "请输入密码",
                        minlength: "密码长度不能小于 5 个字母"
                    },
                    confirm_password: {
                        required: "请输入密码",
                        minlength: "密码长度不能小于 5 个字母",
                        equalTo: "两次密码输入不一致"
                    },
                    phonenumber: {
                        required: "请输入手机号",
                        phonenumber: "手机号格式不正确"
                    },
                    email: "请输入一个正确的邮箱",
                    agree: "请接受我们的声明",
                    topic: "请选择两个主题"
                }
            })
        });

    </script>
    <style>
        .error{
            color:red;
        }
    </style>
</head>
<body>
<form class="form-signin" id="commentForm">
    <fieldset>
        <h2 class="form-signin-heading"><i class="glyphicon glyphicon-log-in"></i> 用户注册</h2>
        <div class="form-group has-success has-feedback">
        <p>
            <label for="username">用户名 (必需, 最小两个字母)</label>
            <input id="username" name="username" minlength="2" type="text" class="form-control" required>
        </p>
        </div>
        <div class="form-group has-success has-feedback">
        <p>
            <label for="password">密码 (必需)</label>
            <input id="password" class="form-control" name="password" type="password" required>
        </p>
        </div>
        <div class="form-group has-success has-feedback">
            <p>
                <label for="confirm_password">再次输入密码 </label>
                <input id="confirm_password" class="form-control" name="confirm_password" type="password" required>
            </p>
        </div>
        <div class="form-group has-success has-feedback">
        <p>
            <label for="email">E-Mail (必需)</label>
            <input id="email" class="form-control" type="email" name="email" required>
        </p>
        </div>
        <div class="form-group has-success has-feedback">
        <p>
            <label for="phonenumber">电话 (必需)</label>
            <input id="phonenumber" class="form-control" name="phonenumber" type="text" >
        </p>
        </div>
        <div class="form-group has-success has-feedback">
        <p>
            <input class="btn btn-lg btn-success btn-block" type="submit" value="注册">
        </p>
        </div>
    </fieldset>
</form>
</body>
</html>
