<!DOCTYPE html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html>   
<head>
<meta charset="utf-8">
<title>MyShop——个人注册</title>
<link rel="stylesheet" type="text/css" href="css/index.css">
<link rel="stylesheet" type="text/css" href="css/ziy.css">
	<!--<script src="js/chengs/bootstrap.js"/>-->
<!--<script src="js/jquery-1.11.3.min.js" ></script>-->
<!--<script src="js/index.js" ></script>-->
	<!--<script type="text/javascript" src="js/jquery1.42.min.js"></script>-->
<!--<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>-->
	<!--<script type="text/javascript" src="js/jquery.SuperSlide.2.1.1.source.js"></script>-->
 
</head>
<body>
<!--dengl-->
<div class="yiny">
	<div class="beij_center">
		<div class="dengl_logo">
			<img src="images/logo_1.png">
			<h1>欢迎注册</h1>
		</div>
	</div>
</div>
<div class="beij_center"> 
	<div class="ger_zhuc_beij">
		<div class="ger_zhuc_biaot">
			<ul>
				<li class="ger_border_color"><a href="zhuc.html">个人注册</a></li>
				<i>丨</i>
				<!--<li><a href="shenq_ruz.html">申请入驻</a></li>-->
				<p>我已经注册，现在就<a class="ftx-05 ml10" href="login.html">登录</a></p>
			</ul>
		</div>
		<form class="zhuc_biaod" id="RegisterCheck">
			<div class="reg-items" >
              	<span class="reg-label">
                	<label for="userName">用户名：</label>
              	</span>
              	<input   class="i-text" type="text" id="userName" minlength="8" maxlength="20" required>
              	<!--备注————display使用 inline-block-->
              	<div class="msg-box">
                	<div class="msg-box" style="display: none;">
	                  	<div class="msg-weak" style="display: none;"> <i></i>
	                    	<div class="msg-cont">4-20个字符，支持汉字、字母、数字及“-”、“_”组合</div>
	                  	</div>
                	</div>
                	<div class="msg-weak err-tips"  style="display: none;"><div>请输入用户名</div></div>
            	</div>
            	<span class="suc-icon"></span>
            </div>
            <div class="reg-items" >
              	<span class="reg-label">
                	<label for="password">设置密码：</label>
              	</span>
              	<input   class="i-text" type="password" id="password" minlength="8" maxlength="20" required>
              	<!--备注————display使用 inline-block-->
              	<div class="msg-box">
                	<div class="msg-box" style="display: none;">
	                  	<div class="msg-weak" style="display: inline-block;"> <i></i>
	                    	<div class="msg-cont">键盘大写锁定已打开，请注意大小写!</div>
	                  	</div>
                	</div>
                	<div class="msg-weak err-tips"  style="display:none;"><div>请输入密码</div></div>
            	</div> 
            </div>
            <div class="reg-items" >
              	<span class="reg-label">
                	<label for="repassword">确认密码：</label>
              	</span>
              	<input   class="i-text" type="password"  id="repassword" required>
              	<!--备注————display使用 inline-block-->
              	<div class="msg-box">
                	<div class="msg-weak err-tips"  style="display: none;"><div>密码不一样</div></div>
            	</div> 
            </div>
            <div class="reg-items" >
              	<span class="reg-label">
                	<label for="phoneNumber">手机号码：</label>
              	</span>
              	<input   class="i-text" type="text" id="phoneNumber" required>
              	<!--备注————display使用 inline-block-->
              	<div class="msg-box"> 
                	<div class="msg-weak err-tips"  style="display:none;"><div>手机号不能为空</div></div>
            	</div> 
            </div> 
            <div class="reg-items" >
              	<span class="reg-label">
                	<label for="email">邮箱号码：</label>
              	</span>
              	<input   class="i-text" type="text" id="email" required>
              	<div class="check check-border" style="position:relative;left:0">
                   	<input class="check-phone" type="button" style="padding:11px 10px 14px 10px;background-color:red;color: white" value="获取短信验证码" onclick="toCode()">
                  	<!--<span class="check-phone disable" style="display: none;"><em>60</em>秒后重新获取</span>-->
                  <!--<a class="check-phone" style="display: none;padding:11px 10px 14px 10px">重新获取验证码</a>-->
					<input  class="i-text i-short" type="text" id="checkcode" name="checkcode" required>
                </div>
              	<!--备注————display使用 inline-block-->
              	<div class="msg-box"> 
                	<div class="msg-weak err-tips"  style="display:none;"><div>请输入短信验证码</div></div>
            	</div>
            </div>
            <div class="reg-items" >
              	<div class="dag_biaod">
              		<input type="checkbox" value="english" id="accept" name="accept">
              		阅读并同意
              		<a href="#" class="ftx-05 ml10">《MyShop用户注册协议》</a>
              		<a href="#" class="ftx-05 ml10">《隐私协议》</a>
              	</div>
            </div>
            <div class="reg-items" >
              	<input class="reg-btn" value="立即注册" type="submit">
            </div>
		</form>
        <div class="xiaogg">
            <img src="images/cdsgfd.jpg">
        </div>
	</div>
</div>


<div class="jianj_dib jianj_dib_1">
	<div class="beia_hao">
		<p>京ICP备：123456789号  </p>
		<p class="gonga_bei">京公网安备：123456789号</p>
	</div>
</div>

</body>
<script src="jquery/jquery-2.1.1.min.js"></script>
<script src="jquery/jquery.validate.js"></script>
<script src="lib/jquery.js"/>
<script src="dist/jquery.validate.min.js"/>
<script src="dist/localization/messages_zh.js"/>
<script type="text/javascript">
	var code;
	var userName=$("#userName").val();
	var password=$("#password").val();
	var phoneNumber=$("#phoneNumber").val();
	var email=$("#email").val();
	function toCode() {
		var email = $.trim($("#email").val());
		if (email != null && email != '') {
			$.ajax({
				url: "checkEmail",
				type: "POST",
				data: {
					email: function () {
						return email;
					}
				},
				success: function (response) {
					window.confirm("验证码已经发送至您邮箱,请查收，请勿重复提交!");
					code = response;
				}
			})
		} else {
			alert("请先输入邮箱地址");
		}
	}
	$().ready(function () {
		$("#RegisterCheck").validate({
			rules: {
				userName: {
					required: true,
					minlength: 6,
					maxlength: 20,
					remote: {
						url: "checkUserName",     //后台处理程序
						type: "POST", //数据发送方式
						data: {
							userName: function () {
								return userName;
							}
						},//要传递的参数
					}
				},
				password: {
					required: true,
					minlength: 8,
					maxlength: 20
				},
				repassword: {
					required: true,
					equalTo: "#password"
					// required: true,
					// minlength: 8,
					// maxlength: 20
				},
				email: {
					required: true,
					email: true
				},
				checkcode: {
					digits: true,
					required: true,
					rangelength: [4, 4]

				},
				phoneNumber: {
					digits: true,
					required: true,
					rangelength: [11, 11]
				}
			},
			messages: {
				userName: {
					required: "请输入用户名",
					minlength: "至少输入{0}个字符",
					maxlength: "最多输入20个字符",
					remote: "用户名已存在"
				},
				password: {
					required: "请输入密码",
					minlength: "至少输入{0}个字符",
					maxlength: "最多输入{0}个字符"
				},
				repassword: {
					required: "请输入确认密码",
					equalTo: "两次输入不一致"
				},
				email: {
					required: "请输入邮箱",
					email: "请输入正确的邮箱格式"
				},
				checkcode: {
					required: "请输入验证码",
					digits: "请输入数字",
					rangelength: "请输入四位数"
				},
				phoneNumber: {
					required: "电话号码不能为空",
					digits: "请输入数字",
					rangelength: "电话号码为11位数字",
					phoneNumber:"手机号格式不正确"
				}
			}
		})
	});
	// 用户注册
	if ($("#accept").prop("checked") == true) {
		alert("请认真阅读使用条款并勾选");
	}
	$("#checkcode").blur(function () {
		var checkcode = $.trim($("#checkcode").val());
		if (code != checkcode) {
			alert("验证码错误")
		}
	});
	$.validator.addMethod("phoneNumber",function (value,element) {
		var length=value.length;
		var phoneNumber1 = /^(((13[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
		return this.optional(element) || (length == 11 && phoneNumber1.test(value));
	});
	$.validator.setDefaults({
		submitHandler:function () {
			$.ajax({
				type: 'POST',
				url: "/RegisterUser",
				contentType: "application/json; charset=utf-8",
				data: JSON.stringify({
					"userName": userName,
					"password": password,
					"phoneNumber": phoneNumber,
					"email": email
				}),
				success: function (data) {
					console.log(data);
					if (data == true) {
						window.location.href = "login.html";
					}
				},
				error: function (data) {
					alert(data);
					console.error(data);
					// window.location.href = "zhuc.html";
				},
				dataType: "json"
			});
		}
	})
</script>
<style>
	.error{
		color:red;
	}
</style>
</html>
